<div class="d-flex p-3 mb-2 justify-content-center">
  <div class="darkcard">
    <h1 class="darktitle"><strong>Event Name:</strong><%= @event.name %> </h1>
    <div class="row justify-content-center">

      <div class="col">
        <div class="d-flex justify-content-center">
          <% if @event.photo.present? %>
            <%= image_tag @event.photo.url, alt:"profile pic", width:"80%", class:"mycard" %>
          <% else %>
            <%= image_tag "favicon.png", alt:"profile pic", width:"200px", class:"rounded-circle" %>
          <% end %>
        </div>
        <div class="d-flex justify-content-center pt-3">
          <%= form_with model: VendorEvent.new, url: vendor_events_path do |form|%>
            <%= form.hidden_field :event_id, value: @event.id %>
            <%= form.submit 'Add to My Events', class: 'btn-pri' %>
          <% end %>
        </div>

        <div class="d-flex justify-content-center pt-3">Host:
          <%= link_to user_path(@host) do %>
            <% if @host.photo.present? %>
              <%= image_tag @host.photo.url, alt: "profile pic", width: "20px" %>
              <%= @host.username %>
            <% else %>
              <%= image_tag "favicon.png", alt: "profile pic", width: "30px" %>
              <%= @host.username %>
            <% end %>
          <% end %>
        </div>
        <br>
          <div>
            <% if @host.private == true || @user.leaders.include?(@host) == false %>
              <%= link_to "Follow host to see more!", follow_request_path, class: 'btn' %>
            <% end %>
          </div>
      </div>

      <div class="col">
        <p class="card-text">
          <strong>Applications due:</strong>
          <%= @event.application_due_at.strftime("%B %d, %Y") %></p>

        <p class="card-text">
          <strong>Event Begins:</strong>
          <%= @event.started_at.strftime("%B %d, %Y") %></p>
        <% if @event.ends_at.present? %>
        <p class="card-text">
          <strong>Event Ends:</strong>
          <%= @event.ends_at.strftime("%B %d, %Y") %></p>
        <% end %>

        <p class="card-text">
          <strong>Information:</strong>
          <%= @event.information %></p>

        <p class="card-text">
          <strong>Application link:</strong>
          <%= link_to  @event.application_link, @event.application_link, target: "_blank" %></p>

        <p class="card-text">
          <strong>Tags:</strong>
          <%= @event.tags %></p>

        <p class="card-text">
          <strong>Address:</strong>
          <%= @event.address %></p>
      </div>
    </div>

    <div class="row justify-content-around pt-2">
      <% if current_user.vendor_events.exists?(event_id: @event.id) %>
        <%= link_to "My event", vendor_event_path(current_user.vendor_events.find_by(event_id: @event.id)) %>
      <% end %>

      <% if @host == current_user %>
        <%= link_to "Edit this event", edit_event_path(@event), class:"btn-in" %>
        <%= link_to "Destroy this event", @event, method: :delete, class:"btn-in"  %>
      <% end %>
    </div>
  </div>
</div>

<div class="darkcard">
  <% if @comments.present? %>
    <ul class="list-group list-group-flush">
      <% @comments.each do |comment| %>
        <li id="comment_<%= comment.id %>" class="comment-container">
          <div class="d-flex">
            <%= image_tag "bulb.png", alt: "profile pic", width: "50px", height: "50px" %>
          </div>
          <div class="col">
            <h6 class="mt-0"><%= comment.author.username %></h6>
            <p id="comment-body-<%= comment.id %>"><%= comment.body %></p>

            <% if current_user == comment.author %>
              <div class="d-flex justify-content-between">
                
                <div id="edit-form-<%= comment.id %>" style="display: none; width: 100%;">
                  <%= form_with(model: [@event, comment], remote: true) do |form| %>
                  
                    <%= form.rich_text_area :body, class: "form-control", value: comment.body %>
                  
                    <%= form.submit "Update", class: "btn-in" %>
                  <% end %>
                </div>
                <div>
                <button class="btn-in" onclick="showEditForm(<%= comment.id %>)">Edit</button>
                </div>
                <div>
                <%= link_to "Delete", delete_comment_path(comment),  method: :delete, data: { confirm: "Are you sure you want to delete this comment?" }, class: "btn-in" %>
                </div>
              </div>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul> <!-- This should be outside the loop -->
  <% else %>
    <p>No comments found.</p>
  <% end %>

  <!-- Render the comment form -->
  <div class="card-body">
    <%= render "comments/form", comment: @event.comments.build %>
  </div>
</div>
